<% provide(:title, 'Adventure') %>

<div class="row">
  <div class="small-9 small-centered columns story">
    <p class="adventure"><%= @adventure.story %></p>
    <% @adventure.uploads.each do |upload| %>
      <%= image_tag upload.image(:medium) %>
    <% end %>
  </div>
</div>

<div class="row">
  <% if @adventure.published_open? %>
    <div class="small-9 small-centered columns">
    <%= link_to 'Add your story', new_adventure_path(:id => @adventure.id), :id => "new_link", :class => "button", remote: true %>
    </div>
    <h4>Adventure Submissions</h4>
    <div class="row" id="submissions">
      <% @submissions.each do |adventure| %>
        <div class="large-6 columns">
          <div class="submission">
            <p><em>This path: </em><%= adventure.choice %></p>
            <p><em>Leads to this story: </em><%= adventure.story %></p>
            <hr class="divider">
            <!-- submission info:   votes, vote_up button, delete  -->
            <% if user_signed_in? %>
              <ul class="inline-list">
                <li>
                  <%= form_for adventure.votes.new do |f| %>
                    <%= f.hidden_field :adventure_id %>
                    <%= f.hidden_field :user_id, :value => current_user.id %>
                    <%= f.submit "Upvote", data: { disable_with: 'Voting...' }, :class => "button [tiny small large]"%>
                  <% end %>
                </li>
                <li>
                  <%= adventure.vote_count %>
                </li>
                <li>
                 <%if current_user.admin? || current_user.id == adventure.user_id %>
                    <%= button_to 'Destroy', adventure, method: :delete, data: { confirm: 'Are you sure?' }, data: { disable_with: 'Deleting...' }, :class => "button [tiny small large]"  %>
                  <% end %>
                </li>
              </ul>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <% @adventure.children.each do |child| %>
      <% if child.is_only_child? %>
          <div class="small-6 small-centered columns choice">
            <p class="adventure"><%= child.choice %></p>
            <%= link_to 'Follow this path', child, :class => "button" %>
          </div>
      <% else %>
        <div class="small-5 columns choice"> 
          <div class="row"> 
            <p class="adventure"><%= child.choice %></p>
          </div>
          <div class="small-6 small-centered columns">
            <%= link_to 'Choose this path', child, :class => "button" %>
          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>